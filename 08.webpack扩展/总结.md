# 总结 Webpack

## Webpack 基本概念

1. entry 入口

- 以某个文件为入口开始打包
- 分类
  - 单入口 String 
    - 只会输出一个文件
    - 单页面应用（SPA）
  - 多入口 Array / Object
    - Array 只会输出一个文件
    - Object 会输出多个文件
      - 多页面应用

2. output 输出

- 打包后资源输出到哪里去

3. loader 加载器

- webpack 本身只能识别 json、js 模块，其他模块一旦加载就会报错
- 需要借助 loader 帮助 webpack 识别它识别不了的模块

4. plugins 插件

- loader 功能有限，要想做功能更加强大的工作交给插件

5. mode

- 模式：开发环境（development）和生产环境（production）

## Webpack 基本配置
1. 处理JS文件
  eslint-loader
    在package.json中配置eslintConfig来指示eslint-loader到底要干什么事
    enfore: 'pre' 优先执行
  babel-loader
    在package.json中配置babel来指示babel-loader到底要干什么事
2. 处理Vue文件
  vue-loader
3. 处理JSX文件
  babel-loader
    presets: ['@babel/preset-react']
4. 处理CSS文件
  开发环境：创建style标签插入样式
    style-loader
    css-loader
    postcss-loader
    less-loader / sass-loader / stylus-loader
  生产环境：提取单独css文件，将来通过link引入
    MiniCssExtractPlugin.loader（还需要配置插件 new MiniCssExtractPlugin）
    css-loader
    postcss-loader
    less-loader / sass-loader / stylus-loader
5. 处理HTML文件
  new HtmlWebpackPlugin({ template: './public/index.html' })
6. 处理图片文件
  url-loader
    limit: 10000 小于10kb一下的图片会被base64处理
7. 处理其他类型文件（如字体图标、音视频等）
  file-loader 原封不动输出

## Webpack 优化手段
- 优化打包构建速度
1. HMR 热模块替换
  为什么要用？
    默认情况下，一旦修改了代码，全部代码重新编译刷新，速度慢（全体刷新）
  有什么作用？
    只更新修改的模块，其他模块不变（局部更新）  
  怎么使用？
    devServer: { hot: true }  
    new webpack.HotModuleReplacementPlugin()  
    注意：默认情况下只有样式文件有HMR功能（style-loader），JS是没有的
    开启JS的HMR功能：
      1. 手写JS代码 --> module.hot.accpet('模块路径', () => {})
      2. 在Vue使用 --> vue-loader
      3. 在React使用 --> react-hot-loader

- 优化打包代码体积和性能
1. 兼容性处理
  JS
    1. babel-loader presets: ['@babel/preset-env'] 问题就是只能编译/转换简单语法
    2. @babel/polyfill 做复杂语法兼容，问题是体积太大了
    3. core-js 在@babel/preset-env基础上，增加了useBuiltIns: 'usage'来实现按需加载
  CSS  
    postcss-loader 
    在package.json中指定browserslist来指示postcss-loader兼容性做到什么程度

2. tree shaking 树摇
  去除没有使用的JS代码
  注意：
    1. 必须使用ES6模块化（需要禁止@babel/preset-env转换ES6模块化语法 modules: false）
    2. 开启webpack的生产模式（内部启用TerserPlugin，用来压缩JS代码的插件，tree shaking功能就是这个插件完成的）
    3. 在package.json配置sideEffects来指定哪些文件需要进行tree shaking

3. code split 代码分割
  作用：1. 抽取公共代码 2. 拆分多个文件，减少单个文件体积（避免单次请求时间过长）
  配置：
    1. 多入口 + optimization
      将node_modules抽取成单独模块
      将多入口的公共模块也抽取成单独模块
    2. 单入口 + optimization + import
      将node_modules抽取成单独模块
      动态导入语法import就能将某些文件抽取成单独模块
        1. 原生 JS
        2. React，可以使用Suspence + lazy来实现路由组件的动态导入
        3. Vue，() => import('./Foo.vue')
          React和Vue的目的都是为了将路由组件抽取成单独模块，单独加载

## Webpack 原理分析
